<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Pong Deluxe</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:radial-gradient(circle,#0b1c2d,#020814);
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

#menu, #gameOver {
  text-align:center;
}

button{
  padding:12px 20px;
  margin:10px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#00d4ff;
  color:#001018;
  cursor:pointer;
  font-weight:bold;
}

button:hover{background:#00aacc}

canvas{
  background:linear-gradient(180deg,#061b2e,#020814);
  border:4px solid #00d4ff;
  border-radius:10px;
}

#hud{
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
  font-size:18px;
}
</style>
</head>

<body>

<div id="menu">
  <h1>üèì PONG DELUXE</h1>
  <p>Elige modo de juego</p>
  <button onclick="startGame('ai')">VS M√°quina</button>
  <button onclick="startGame('pvp')">VS Jugador</button>
</div>

<div id="game" style="display:none;">
  <div id="hud">
    <div id="score">0 - 0</div>
    <div id="info">Primero a 5</div>
  </div>
  <canvas id="canvas" width="900" height="500"></canvas>
</div>

<div id="gameOver" style="display:none;">
  <h1 id="winnerText"></h1>
  <button onclick="resetToMenu()">Volver al men√∫</button>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let mode = "ai";
let running = false;
let score1 = 0, score2 = 0;
const WIN_SCORE = 5;

// paddles
const paddleHeightBase = 90;
let paddle1 = {x:20,y:200,w:12,h:paddleHeightBase,speed:6};
let paddle2 = {x:868,y:200,w:12,h:paddleHeightBase,speed:6};

// ball
let ball = {
  x:450,y:250,r:8,
  vx:5,vy:3,
  speedMult:1
};

// powerups
const powerUps = [];
const POWER_DURATION = 10000; // ‚è±Ô∏è 10 segundos

let activeEffects = {
  bigPaddle:null,
  smallPaddle:null,
  speed:null
};

// input
const keys = {};
window.addEventListener("keydown",e=>keys[e.key]=true);
window.addEventListener("keyup",e=>keys[e.key]=false);

function startGame(selectedMode){
  mode = selectedMode;
  document.getElementById("menu").style.display="none";
  document.getElementById("game").style.display="block";
  resetMatch();
  running = true;
  requestAnimationFrame(loop);
}

function resetMatch(){
  score1=0; score2=0;
  resetBall();
}

function resetBall(){
  ball.x=450; ball.y=250;
  ball.vx = (Math.random()>0.5?1:-1)*5;
  ball.vy = (Math.random()*4-2);
  ball.speedMult=1;
}

function spawnPowerUp(){
  const types=["‚ö°","üé≤","üìè","üìê"];
  powerUps.push({
    x:Math.random()*600+150,
    y:Math.random()*300+100,
    type:types[Math.floor(Math.random()*types.length)]
  });
}

function activatePowerUp(type, player){
  const now = Date.now();

  if(type==="‚ö°"){
    ball.speedMult = 1.8;
    activeEffects.speed = now;
  }

  if(type==="üé≤"){
    const target = player===1 ? paddle2 : paddle1;
    target.y = Math.random()*(canvas.height-target.h);
  }

  if(type==="üìè"){
    paddle1.h = paddleHeightBase*1.6;
    activeEffects.bigPaddle = now;
  }

  if(type==="üìê"){
    paddle2.h = paddleHeightBase*0.6;
    activeEffects.smallPaddle = now;
  }
}

function updatePowerUps(){
  const now = Date.now();

  if(activeEffects.speed && now-activeEffects.speed>POWER_DURATION){
    ball.speedMult=1;
    activeEffects.speed=null;
  }

  if(activeEffects.bigPaddle && now-activeEffects.bigPaddle>POWER_DURATION){
    paddle1.h=paddleHeightBase;
    activeEffects.bigPaddle=null;
  }

  if(activeEffects.smallPaddle && now-activeEffects.smallPaddle>POWER_DURATION){
    paddle2.h=paddleHeightBase;
    activeEffects.smallPaddle=null;
  }
}

function loop(){
  if(!running) return;
  update();
  draw();
  requestAnimationFrame(loop);
}

function update(){
  // player 1
  if(keys["w"]) paddle1.y-=paddle1.speed;
  if(keys["s"]) paddle1.y+=paddle1.speed;

  // player 2 / AI
  if(mode==="pvp"){
    if(keys["ArrowUp"]) paddle2.y-=paddle2.speed;
    if(keys["ArrowDown"]) paddle2.y+=paddle2.speed;
  }else{
    paddle2.y += (ball.y - (paddle2.y+paddle2.h/2))*0.08;
  }

  // clamp
  paddle1.y=Math.max(0,Math.min(canvas.height-paddle1.h,paddle1.y));
  paddle2.y=Math.max(0,Math.min(canvas.height-paddle2.h,paddle2.y));

  // ball move
  ball.x += ball.vx*ball.speedMult;
  ball.y += ball.vy*ball.speedMult;

  if(ball.y<0 || ball.y>canvas.height) ball.vy*=-1;

  // collisions
  checkPaddleCollision(paddle1,1);
  checkPaddleCollision(paddle2,2);

  // scoring
  if(ball.x<0){ score2++; resetBall(); }
  if(ball.x>canvas.width){ score1++; resetBall(); }

  document.getElementById("score").innerText=`${score1} - ${score2}`;

  if(Math.random()<0.005 && powerUps.length<1) spawnPowerUp();

  powerUps.forEach((p,i)=>{
    if(Math.hypot(ball.x-p.x,ball.y-p.y)<14){
      activatePowerUp(p.type,ball.vx<0?2:1);
      powerUps.splice(i,1);
    }
  });

  updatePowerUps();

  if(score1>=WIN_SCORE || score2>=WIN_SCORE){
    endGame();
  }
}

function checkPaddleCollision(p,player){
  if(ball.x-ball.r<p.x+p.w && ball.x+ball.r>p.x &&
     ball.y>p.y && ball.y<p.y+p.h){
    const hitPos=(ball.y-(p.y+p.h/2))/(p.h/2);
    ball.vy = hitPos*6;
    ball.vx*=-1.05;
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // center line
  ctx.setLineDash([10,10]);
  ctx.strokeStyle="#0ff";
  ctx.beginPath();
  ctx.moveTo(450,0);
  ctx.lineTo(450,500);
  ctx.stroke();
  ctx.setLineDash([]);

  // paddles
  ctx.fillStyle="#00d4ff";
  ctx.fillRect(paddle1.x,paddle1.y,paddle1.w,paddle1.h);
  ctx.fillRect(paddle2.x,paddle2.y,paddle2.w,paddle2.h);

  // ball
  ctx.beginPath();
  ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2);
  ctx.fill();

  // powerups
  ctx.font="24px Arial";
  powerUps.forEach(p=>ctx.fillText(p.type,p.x,p.y));
}

function endGame(){
  running=false;
  document.getElementById("game").style.display="none";
  document.getElementById("gameOver").style.display="block";
  document.getElementById("winnerText").innerText =
    score1>score2?"üèÜ Gana Jugador 1":"üèÜ Gana Jugador 2";
}

function resetToMenu(){
  document.getElementById("gameOver").style.display="none";
  document.getElementById("menu").style.display="block";
}
</script>

</body>
</html>
