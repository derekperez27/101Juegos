<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Echo Rhythm</title>
<style>
body{
    margin:0;
    background:#111;
    color:white;
    text-align:center;
    font-family:Arial;
}
canvas{
    background:#000;
    display:block;
    margin:20px auto;
    border:2px solid white;
}

#records {
    margin: 20px auto;
    max-width: 400px;
}

#records h2 {
    color: #00ffff;
}

#recordsList {
    background: #222;
    border: 2px solid #444;
    border-radius: 8px;
    padding: 15px;
    max-height: 300px;
    overflow-y: auto;
}

.record-item {
    display: flex;
    justify-content: space-between;
    padding: 8px;
    margin: 5px 0;
    background: #333;
    border-radius: 5px;
    border-left: 3px solid #00ffff;
}

.record-rank {
    font-weight: bold;
    color: #00ffff;
    margin-right: 10px;
}

.record-level {
    color: #ffd700;
    font-weight: bold;
}

.no-records {
    color: #888;
    font-style: italic;
    padding: 20px;
}

button {
    margin: 10px;
    padding: 10px 20px;
    cursor: pointer;
    font-size: 16px;
    border: none;
    border-radius: 5px;
}

#restartBtn {
    background: #4CAF50;
    color: white;
}

#clearRecordsBtn {
    background: #d32f2f;
    color: white;
    padding: 8px 15px;
    font-size: 14px;
}
</style>
</head>
<body>

<h1>üéµ ECHO RHYTHM</h1>
<p>Nivel: <span id="level">1</span></p>
<p id="msg">Mu√©vete SOLO cuando la onda te toque</p>

<canvas id="c" width="400" height="400"></canvas>
<button id="restartBtn" style="display:none;" onclick="restartGame()">Volver a Jugar</button>

<div id="records">
    <h2>üèÜ R√©cords</h2>
    <div id="recordsList"></div>
    <button id="clearRecordsBtn" onclick="clearRecords()">Borrar R√©cords</button>
</div>

<script>
const c = document.getElementById("c");
const ctx = c.getContext("2d");
const levelSpan = document.getElementById("level");
const msg = document.getElementById("msg");

let level = 1;
let running = true;

// Audio para el eco
const audioContext = new (window.AudioContext || window.webkitAudioContext)();

function playEchoSound() {
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.frequency.value = 600;
    oscillator.type = 'sine';
    
    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
    
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.2);
}

/* ===== R√âCORDS ===== */
function loadRecords() {
    const records = localStorage.getItem('echoRhythmRecords');
    return records ? JSON.parse(records) : [];
}

function saveRecord(level) {
    const records = loadRecords();
    records.push({
        level: level,
        date: new Date().toLocaleDateString()
    });
    // Ordenar por nivel (mayor a menor)
    records.sort((a, b) => b.level - a.level);
    // Guardar solo los mejores 10
    const top10 = records.slice(0, 10);
    localStorage.setItem('echoRhythmRecords', JSON.stringify(top10));
    displayRecords();
}

function displayRecords() {
    const records = loadRecords();
    const recordsList = document.getElementById('recordsList');
    
    if (records.length === 0) {
        recordsList.innerHTML = '<div class="no-records">No hay r√©cords a√∫n. ¬°S√© el primero!</div>';
        return;
    }

    recordsList.innerHTML = records.map((record, index) => {
        let medal = '';
        if (index === 0) medal = 'ü•á';
        else if (index === 1) medal = 'ü•à';
        else if (index === 2) medal = 'ü•â';
        
        return `
            <div class="record-item">
                <span class="record-rank">${medal} #${index + 1}</span>
                <span class="record-level">Nivel ${record.level}</span>
                <span style="color: #666; font-size: 12px;">${record.date}</span>
            </div>
        `;
    }).join('');
}

function clearRecords() {
    if (confirm('¬øEst√°s seguro de que quieres borrar todos los r√©cords?')) {
        localStorage.removeItem('echoRhythmRecords');
        displayRecords();
    }
}

// Mostrar r√©cords al cargar la p√°gina
displayRecords();

/* ===== PLAYER ===== */
const player = { x:200, y:300, r:8 };

/* ===== GOAL ===== */
let goal = { x:200, y:50, r:10 };

/* ===== OBSTACLES ===== */
let obstacles = [];

/* ===== ECHO ===== */
let waveRadius = 0;
let waveSpeed = 2;
let canMove = false;
let waveTouchTime = 0; // Para mostrar feedback visual

function newLevel(){
    obstacles = [];
    waveRadius = 0;
    waveSpeed = 2 + level * 0.5; // M√°s r√°pido progresivamente
    canMove = false;
    waveTouchTime = 0;

    // M√°s obst√°culos y mejor distribuidos
    for(let i=0;i<level+3;i++){
        obstacles.push({
            x: Math.random()*320+40,
            y: Math.random()*240+80,
            r: Math.max(12 - level * 0.5, 6) // M√°s peque√±os con niveles altos
        });
    }

    goal = { x:Math.random()*300+50, y:Math.random()*60+20, r:12 };
    levelSpan.textContent = level;
}

/* ===== INPUT ===== */
document.addEventListener("keydown",e=>{
    if(!running) return;

    if(!canMove){
        gameOver();
        return;
    }

    if(e.key==="w") player.y -= 20;
    if(e.key==="s") player.y += 20;
    if(e.key==="a") player.x -= 20;
    if(e.key==="d") player.x += 20;

    canMove = false;
});

/* ===== UPDATE ===== */
function update(){
    if(!running) return;

    waveRadius += waveSpeed;
    if(waveRadius > 300){
        waveRadius = 0;
    }

    // ¬øeco toca al jugador?
    const d = Math.hypot(player.x-200, player.y-200);
    if(Math.abs(d - waveRadius) < 80){ // Onda el doble de ancha
        if(!canMove) {
            playEchoSound();
            waveTouchTime = 10; // Mostrar feedback visual por 10 frames
        }
        canMove = true;
    }
    
    if(waveTouchTime > 0) waveTouchTime--;

    // colisiones
    obstacles.forEach(o=>{
        if(Math.hypot(player.x-o.x,player.y-o.y) < player.r + o.r){
            gameOver();
        }
    });

    // llegar a meta
    if(Math.hypot(player.x-goal.x,player.y-goal.y) < player.r + goal.r){
        level++;
        player.x = 200;
        player.y = 300;
        newLevel();
    }
}

/* ===== DRAW ===== */
function draw(){
    ctx.clearRect(0,0,400,400);

    // onda
    ctx.strokeStyle = waveTouchTime > 0 ? "#00ff00" : "white"; // Verde cuando toca
    ctx.lineWidth = waveTouchTime > 0 ? 24 : 16; // L√≠nea el doble de gruesa
    ctx.beginPath();
    ctx.arc(200,200,waveRadius,0,Math.PI*2);
    ctx.stroke();
    ctx.lineWidth = 1;

    // C√≠rculo de feedback en el jugador cuando la onda toca
    if(waveTouchTime > 0) {
        ctx.strokeStyle = "rgba(0,255,0," + (waveTouchTime / 10) + ")";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(player.x, player.y, player.r + 5, 0, Math.PI*2);
        ctx.stroke();
        ctx.lineWidth = 1;
    }

    // jugador
    ctx.fillStyle=canMove?"lime":"cyan";
    ctx.beginPath();
    ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
    ctx.fill();

    // meta
    ctx.fillStyle="#00ff00";
    ctx.beginPath();
    ctx.arc(goal.x,goal.y,goal.r,0,Math.PI*2);
    ctx.fill();
    
    // Borde de la meta
    ctx.strokeStyle = "#00ff00";
    ctx.beginPath();
    ctx.arc(goal.x,goal.y,goal.r + 3,0,Math.PI*2);
    ctx.stroke();

    // obst√°culos
    ctx.fillStyle="#ff4444";
    obstacles.forEach(o=>{
        ctx.beginPath();
        ctx.arc(o.x,o.y,o.r,0,Math.PI*2);
        ctx.fill();
    });
}

/* ===== GAME OVER ===== */
function gameOver(){
    running=false;
    saveRecord(level);
    document.getElementById("restartBtn").style.display = "inline-block";
    msg.textContent="üíÄ FUERA DE RITMO - Nivel alcanzado: " + level;
}

function restartGame() {
    running = true;
    level = 1;
    player.x = 200;
    player.y = 300;
    obstacles = [];
    waveRadius = 0;
    canMove = false;
    waveTouchTime = 0;
    
    levelSpan.textContent = 1;
    msg.textContent = "Mu√©vete SOLO cuando la onda te toque";
    document.getElementById("restartBtn").style.display = "none";
    
    newLevel();
}

/* ===== LOOP ===== */
function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
}

newLevel();
loop();
</script>

</body>
</html>
